name: Sync repo

on:
  schedule:
    - cron: "0 1 * * *"
  workflow_dispatch:

jobs:
  get_state:
    runs-on: ubuntu-latest
    outputs:
      EXPLORER: ${{ steps.status.outputs.EXPLORER }}
      UPDATE: ${{ steps.status.outputs.UPDATE }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get commits 
        id: status
        run: |
          echo "EXPLORER=$(git ls-remote -h https://github.com/ping-pub/explorer.git master | cut -f1)" >> $GITHUB_OUTPUT
          grep '^${EXPLORER}$' pingpub.commit && echo "UPDATE=true" >> $GITHUB_OUTPUT || export echo "UPDATE=false" >> $GITHUB_OUTPUT

      - name: Debug
        run:
          env

  repo_sync:
    needs: [get_state]
    runs-on: ubuntu-latest
    if: needs.get_state.outputs.UPDATE
    steps:
      - name: Clone Original Repo
        uses: actions/checkout@v4
        with:
          repository: 'ping-pub/explorer'
          ref: 'master'
          path: 'original'

      - name: Clone SGE Repo
        uses: actions/checkout@v4
        with:
          ref: 'sge'

      - name: Update files
        run:
          ls -la
          ls -la original/
          rm original/chains/mainnet/cosmos.json original/chains/mainnet/neutron.json original/chains/mainnet/nolus.json 
          rm original/chains/mainnet/osmosis.json original/chains/testnet/crossfi.json
          mv original/* ./

